(function(){var t,i,r,e,n,o,s,a,h,u,p,c={}.hasOwnProperty,d=function(t,i){function r(){this.constructor=t}for(var e in i)c.call(i,e)&&(t[e]=i[e]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t};e="seqin",h=function(i){var r;return console.log(i),r=t("#log"),r?(null===i&&(i="[null]"),null==i&&(i="[undefined]"),r.innerHTML+="\n"+e+": "+a(s(i.toString())),r.scrollTop=r.scrollHeight):void 0},o=function(i,r){var e;return console.log("Error in "+i+":"),console.log(r),e=t("#log"),e?(e.innerHTML+="\n<em>Error in <b>"+i+"</b>: \n  "+a(s(r.toString()))+"</em>",e.scrollTop=e.scrollHeight):void 0},s=function(t){return t.replace(/</g,"&lt;")},a=function(t){return t.replace(/\n/g,"\n  ")},t=document.querySelector.bind(document),i=document.querySelectorAll.bind(document),u=function(t,i,r){var e,n,o;e=document.createElement(t);for(n in i)o=i[n],e.setAttribute(n,o);return r&&(e.innerHTML=r),e},n=function(t){var i;for(i=[];t.hasChildNodes();)i.push(t.removeChild(t.lastChild));return i},p={},window.Seqin=r={},window.addEventListener("load",function(){var t;try{}catch(i){return t=i,o("03-seqin-config.coffee",t)}}),r.list=function(t){var i;return null==t&&(t={format:"plain"}),i=new r.Snapshot(t),i.render()},r.Error=function(t){function i(t,i){i=i.replace(/\n\s+/g,"\n"),this.message=""+t.I+" "+t.phase+": "+i}return d(i,t),i}(Error),r.Base=function(){function t(){this.phase="construct"}return t.prototype.I="Seqin.Base",t.prototype.toString=function(){return"[object "+this.I+"]"},t.prototype.phase="init",t}(),r.Grid=function(t){function i(t){this.phase="construct",this.initObject(),this.parseOptions(t),this.recordInstance(),this.validUA(),this.buildElement()}return d(i,t),i.prototype.I="Seqin.Grid",i.prototype.toString=function(){return"[object "+this.I+"]"},i.prototype.phase="init",i.prototype.initObject=function(){return null==p.grids&&(p.grids=[]),null!=p.gridLut?p.gridLut:p.gridLut={}},i.prototype.parseOptions=function(t){if("undefined"==typeof t)throw new r.Error(this,"The `opt` object was not passed to "+this.I+", eg:\n `foo = new "+this.I+"({ id:'bar', ctx:MyCtx, trackCount:2 })`");if("object"!=typeof t)throw new r.Error(this,"The `opt` argument passed to "+this.I+" has type '"+typeof t+"' not 'object'");return this.id=this.validId(t.id),this.ctx=this.validCtx(t.ctx),this.trackCount=this.validTrackCount(t.trackCount)},i.prototype.recordInstance=function(){return p.grids.push(this),p.gridLut[this.id]=this},i.prototype.validId=function(t){var i;if(i=/^[a-z][-a-z0-9]+$/,"undefined"==typeof t)throw new r.Error(this,""+this.I+" `id` is missing");if("string"!=typeof t)throw new r.Error(this,""+this.I+" `id` is type '"+typeof t+"', not 'string'");if(!i.test(t))throw new r.Error(this,""+this.I+" `id` '"+t+"' fails "+i);if(p.gridLut[t])throw new r.Error(this,"Duplicate "+this.I+" `id` '"+t+"'");return t},i.prototype.validCtx=function(t){var i;if(i=/^\[object (Offline)?AudioContext\]$/,"undefined"==typeof t)throw new r.Error(this,"`ctx` of "+this.I+" `"+this.id+"` is missing.");if("object"!=typeof t)throw new r.Error(this,"`ctx` of "+this.I+" `"+this.id+"` has type '"+typeof t+"' not 'object'");if(!i.test(t))throw new r.Error(this,"`ctx` of "+this.I+" `"+this.id+"` is invalid. It fails "+i);return t},i.prototype.validTrackCount=function(t){if("undefined"==typeof t)throw new r.Error(this,"`trackCount` of "+this.I+" `"+this.id+"` is missing");if("number"!=typeof t)throw new r.Error(this,"`trackCount` of "+this.I+" `"+this.id+"` has type '"+typeof ctx+"' not 'number'");if(!(t>=1&&24>=t))throw new r.Error(this,"`trackCount` of "+this.I+" `"+this.id+"` is `"+t+"`. Must be from 1 to 24");if(t%1)throw new r.Error(this,"`trackCount` of "+this.I+" `"+this.id+"` is `"+t+"`. Must be an integer");return t},i.prototype.validUA=function(){if("complete"!==document.readyState)throw new r.Error(this,"`document.readyState` is currently '"+document.readyState+"'. \n Please wait for 'complete', eg `window.addEventListener('load', ...)`")},i.prototype.buildElement=function(){var t,i,e;for(this.tracks=[],t=i=0,e=this.trackCount;e>=0?e>=i:i>=e;t=e>=0?++i:--i)this.tracks.push(new r.Track({id:""+this.id+"-track-"+t,parent:this}));return h("buildElement "+this.id)},i.prototype.takeSnapshot=function(){return{id:this.id,trackCount:this.trackCount}},i.prototype.visualise=function(t){var i,r,e,n;for(this.$container=t,this.$visual=u("div",{"class":"seqin-grid",id:"seqin-"+this.id},"Seqin Grid "+this.id),n=this.tracks,r=0,e=n.length;e>r;r++)i=n[r],i.visualise(this.$visual);return t.appendChild(this.$visual)},i.prototype.unvisualise=function(){var t,i,r,e;for(e=this.tracks,i=0,r=e.length;r>i;i++)t=e[i],t.unvisualise;return n(this.$visual),this.$container.removeChild(this.$visual),delete this.$visual,h(this.$visual)},i}(r.Base),r.Track=function(t){function i(t){this.phase="construct",this.initObject(),this.parseOptions(t),this.recordInstance(),this.validUA(),this.buildElement()}return d(i,t),i.prototype.I="Seqin.Track",i.prototype.toString=function(){return"[object "+this.I+"]"},i.prototype.phase="init",i.prototype.initObject=function(){return null==p.tracks&&(p.tracks=[]),null!=p.trackLut?p.trackLut:p.trackLut={}},i.prototype.parseOptions=function(t){if("undefined"==typeof t)throw new r.Error(this,"The `opt` object was not passed to "+this.I+", eg: \n `foo = new "+this.I+"({ id:'bar', ctx:MyCtx, trackCount:2 })`");if("object"!=typeof t)throw new r.Error(this,"The `opt` argument passed to "+this.I+" has type '"+typeof t+"' not 'object'");return this.id=this.validId(t.id),this.parent=this.validParent(t.parent)},i.prototype.recordInstance=function(){return p.tracks.push(this),p.trackLut[this.id]=this},i.prototype.validId=function(t){var i;if(i=/^[a-z][-a-z0-9]+$/,"undefined"==typeof t)throw new r.Error(this,""+this.I+" `id` is missing");if("string"!=typeof t)throw new r.Error(this,""+this.I+" `id` is type '"+typeof t+"', not 'string'");if(!i.test(t))throw new r.Error(this,""+this.I+" `id` '"+t+"' fails "+i);if(p.trackLut[t])throw new r.Error(this,"Duplicate "+this.I+" `id` '"+t+"'");return t},i.prototype.validParent=function(t){var i;if(i=/^\[object Seqin.Grid\]$/,"undefined"==typeof t)throw new r.Error(this,"`parent` of "+this.I+" `"+this.id+"` is missing. \nMust be a Seqin.Grid instance");if("object"!=typeof t)throw new r.Error(this,"`parent` of "+this.I+" `"+this.id+"` has type '"+typeof t+"' not 'object'");if(!i.test(t))throw new r.Error(this,"`parent` of "+this.I+" `"+this.id+"` is invalid. \nIt fails "+i);return t},i.prototype.validUA=function(){if("complete"!==document.readyState)throw new r.Error(this,"`document.readyState` is currently '"+document.readyState+"'. \n Please wait for 'complete', eg `window.addEventListener('load', ...)`")},i.prototype.buildElement=function(){return h("buildElement "+this.id)},i.prototype.takeSnapshot=function(){return{id:this.id}},i.prototype.visualise=function(t){return this.$container=t,this.$visual=u("div",{"class":"seqin track",id:"seqin-"+this.id},"Seqin Track "+this.id),t.appendChild(this.$visual)},i.prototype.unvisualise=function(){return n(this.$visual),this.$container.removeChild(this.$visual),delete this.$visual,h(this.$visual)},i}(r.Base),r.Snapshot=function(t){function i(t){this.phase="construct",this.initObject(),this.parseOptions(t),this.takeSnapshot()}var e;return d(i,t),i.prototype.I="Seqin.Snapshot",i.prototype.toString=function(){return"[object "+this.I+"]"},i.prototype.phase="init",i.prototype.initObject=function(){return null==p.masters&&(p.masters=[]),null!=p.masterLut?p.masterLut:p.masterLut={}},i.prototype.parseOptions=function(t){if("undefined"==typeof t)throw new r.Error(this,"The `opt` object was not passed to "+this.I+", eg: \n`foo = new "+this.I+"({...})`");if("object"!=typeof t)throw new r.Error(this,"The `opt` argument passed to "+this.I+" has type '"+typeof t+"' not 'object'");return this.format=this.validFormat(t.format)},i.prototype.takeSnapshot=function(){var t,i,r,e,n;for(this.model={masters:[],masterLut:{}},e=p.masters,n=[],i=0,r=e.length;r>i;i++)t=e[i],n.push(this.model.masters.push(this.model.masterLut[t.id]=t.takeSnapshot()));return n},i.prototype.validFormat=function(t){if("undefined"==typeof t)throw new r.Error(this,"`format` is missing");if("string"!=typeof t)throw new r.Error(this,"`format` is type '"+typeof t+"', not 'string'");if(!e[t])throw new r.Error(this,"`format` '"+t+"' is invalid. \nPlease use "+Object.keys(e));return t},e={raw:function(t){return t},arrays:function(t){return{master:t.masters}},luts:function(t){return{master:t.masterLut}},plain:function(t){var i,r,e,n,o,s;for(e="\nSeqin.Master:",s=t.masters,i=n=0,o=s.length;o>n;i=++n)r=s[i],e+="\n  #"+i+" "+r.trackCount+"-track '"+r.id+"'";return e}},i.prototype.render=function(){return e[this.format](this.model)},i}(r.Base)}).call(this);