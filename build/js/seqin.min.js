(function(){var t,i,e,r,n,o,s,a,h,u,p,c={}.hasOwnProperty,f=function(t,i){function e(){this.constructor=t}for(var r in i)c.call(i,r)&&(t[r]=i[r]);return e.prototype=i.prototype,t.prototype=new e,t.__super__=i.prototype,t};r="seqin",h=function(i){var e;return console.log(i),e=t("#log"),e?(null===i&&(i="[null]"),null==i&&(i="[undefined]"),e.innerHTML+="\n"+r+": "+a(s(i.toString())),e.scrollTop=e.scrollHeight):void 0},o=function(i,e){var r;return console.log("Error in "+i+":"),console.log(e),r=t("#log"),r?(r.innerHTML+="\n<em>Error in <b>"+i+"</b>: \n  "+a(s(e.toString()))+"</em>",r.scrollTop=r.scrollHeight):void 0},s=function(t){return t.replace(/</g,"&lt;")},a=function(t){return t.replace(/\n/g,"\n  ")},t=document.querySelector.bind(document),i=document.querySelectorAll.bind(document),u=function(t,i,e){var r,n,o;r=document.createElement(t);for(n in i)o=i[n],r.setAttribute(n,o);return e&&(r.innerHTML=e),r},n=function(t){var i;for(i=[];t.hasChildNodes();)i.push(t.removeChild(t.lastChild));return i},p={},window.Seqin=e={},window.addEventListener("load",function(){var t;try{}catch(i){return t=i,o("03-seqin-config.coffee",t)}}),e.list=function(t){var i;return null==t&&(t={format:"plain"}),i=new e.Snapshot(t),i.render()},e.Error=function(t){function i(t,i){i=i.replace(/\n\s+/g,"\n"),this.message=""+t.I+" "+t.phase+": "+i}return f(i,t),i}(Error),e.Base=function(){function t(){this.phase="construct"}return t.prototype.I="Seqin.Base",t.prototype.toString=function(){return"[object "+this.I+"]"},t.prototype.phase="init",t}(),e.Master=function(t){function i(t){this.phase="construct",this.initObject(),this.parseOptions(t),this.recordInstance(),this.validUA(),this.buildElement()}return f(i,t),i.prototype.I="Seqin.Master",i.prototype.toString=function(){return"[object "+this.I+"]"},i.prototype.phase="init",i.prototype.initObject=function(){return null==p.masters&&(p.masters=[]),null!=p.masterLut?p.masterLut:p.masterLut={}},i.prototype.parseOptions=function(t){if("undefined"==typeof t)throw new e.Error(this,"The `opt` object was not passed to "+this.I+", eg:\n `foo = new "+this.I+"({ id:'bar', ctx:MyCtx, trackCount:2 })`");if("object"!=typeof t)throw new e.Error(this,"The `opt` argument passed to "+this.I+" has type '"+typeof t+"' not 'object'");return this.id=this.validId(t.id),this.ctx=this.validCtx(t.ctx),this.trackCount=this.validTrackCount(t.trackCount)},i.prototype.recordInstance=function(){return p.masters.push(this),p.masterLut[this.id]=this},i.prototype.validId=function(t){var i;if(i=/^[a-z][-a-z0-9]+$/,"undefined"==typeof t)throw new e.Error(this,""+this.I+" `id` is missing");if("string"!=typeof t)throw new e.Error(this,""+this.I+" `id` is type '"+typeof t+"', not 'string'");if(!i.test(t))throw new e.Error(this,""+this.I+" `id` '"+t+"' fails "+i);if(p.masterLut[t])throw new e.Error(this,"Duplicate "+this.I+" `id` '"+t+"'");return t},i.prototype.validCtx=function(t){var i;if(i=/^\[object (Offline)?AudioContext\]$/,"undefined"==typeof t)throw new e.Error(this,"`ctx` of "+this.I+" `"+this.id+"` is missing.");if("object"!=typeof t)throw new e.Error(this,"`ctx` of "+this.I+" `"+this.id+"` has type '"+typeof t+"' not 'object'");if(!i.test(t))throw new e.Error(this,"`ctx` of "+this.I+" `"+this.id+"` is invalid. It fails "+i);return t},i.prototype.validTrackCount=function(t){if("undefined"==typeof t)throw new e.Error(this,"`trackCount` of "+this.I+" `"+this.id+"` is missing");if("number"!=typeof t)throw new e.Error(this,"`trackCount` of "+this.I+" `"+this.id+"` has type '"+typeof ctx+"' not 'number'");if(!(t>=1&&24>=t))throw new e.Error(this,"`trackCount` of "+this.I+" `"+this.id+"` is `"+t+"`. Must be from 1 to 24");if(t%1)throw new e.Error(this,"`trackCount` of "+this.I+" `"+this.id+"` is `"+t+"`. Must be an integer");return t},i.prototype.validUA=function(){if("complete"!==document.readyState)throw new e.Error(this,"`document.readyState` is currently '"+document.readyState+"'. \n Please wait for 'complete', eg `window.addEventListener('load', ...)`")},i.prototype.buildElement=function(){var t,i,r;for(this.tracks=[],t=i=0,r=this.trackCount;r>=0?r>=i:i>=r;t=r>=0?++i:--i)this.tracks.push(new e.Track({id:""+this.id+"-track-"+t,parent:this}));return h("buildElement "+this.id)},i.prototype.takeSnapshot=function(){return{id:this.id,trackCount:this.trackCount}},i.prototype.visualise=function(t){var i,e,r,n;for(this.$container=t,this.$visual=u("div",{"class":"seqin-master",id:"seqin-"+this.id},"Seqin Master "+this.id),n=this.tracks,e=0,r=n.length;r>e;e++)i=n[e],i.visualise(this.$visual);return t.appendChild(this.$visual)},i.prototype.unvisualise=function(){var t,i,e,r;for(r=this.tracks,i=0,e=r.length;e>i;i++)t=r[i],t.unvisualise;return n(this.$visual),this.$container.removeChild(this.$visual),delete this.$visual,h(this.$visual)},i}(e.Base),e.Track=function(t){function i(t){this.phase="construct",this.initObject(),this.parseOptions(t),this.recordInstance(),this.validUA(),this.buildElement()}return f(i,t),i.prototype.I="Seqin.Track",i.prototype.toString=function(){return"[object "+this.I+"]"},i.prototype.phase="init",i.prototype.initObject=function(){return null==p.tracks&&(p.tracks=[]),null!=p.trackLut?p.trackLut:p.trackLut={}},i.prototype.parseOptions=function(t){if("undefined"==typeof t)throw new e.Error(this,"The `opt` object was not passed to "+this.I+", eg: \n `foo = new "+this.I+"({ id:'bar', ctx:MyCtx, trackCount:2 })`");if("object"!=typeof t)throw new e.Error(this,"The `opt` argument passed to "+this.I+" has type '"+typeof t+"' not 'object'");return this.id=this.validId(t.id),this.parent=this.validParent(t.parent)},i.prototype.recordInstance=function(){return p.tracks.push(this),p.trackLut[this.id]=this},i.prototype.validId=function(t){var i;if(i=/^[a-z][-a-z0-9]+$/,"undefined"==typeof t)throw new e.Error(this,""+this.I+" `id` is missing");if("string"!=typeof t)throw new e.Error(this,""+this.I+" `id` is type '"+typeof t+"', not 'string'");if(!i.test(t))throw new e.Error(this,""+this.I+" `id` '"+t+"' fails "+i);if(p.trackLut[t])throw new e.Error(this,"Duplicate "+this.I+" `id` '"+t+"'");return t},i.prototype.validParent=function(t){var i;if(i=/^\[object Seqin.Master\]$/,"undefined"==typeof t)throw new e.Error(this,"`parent` of "+this.I+" `"+this.id+"` is missing. \nMust be a Seqin.Master instance");if("object"!=typeof t)throw new e.Error(this,"`parent` of "+this.I+" `"+this.id+"` has type '"+typeof t+"' not 'object'");if(!i.test(t))throw new e.Error(this,"`parent` of "+this.I+" `"+this.id+"` is invalid. \nIt fails "+i);return t},i.prototype.validUA=function(){if("complete"!==document.readyState)throw new e.Error(this,"`document.readyState` is currently '"+document.readyState+"'. \n Please wait for 'complete', eg `window.addEventListener('load', ...)`")},i.prototype.buildElement=function(){return h("buildElement "+this.id)},i.prototype.takeSnapshot=function(){return{id:this.id}},i.prototype.visualise=function(t){return this.$container=t,this.$visual=u("div",{"class":"seqin track",id:"seqin-"+this.id},"Seqin Track "+this.id),t.appendChild(this.$visual)},i.prototype.unvisualise=function(){return n(this.$visual),this.$container.removeChild(this.$visual),delete this.$visual,h(this.$visual)},i}(e.Base),e.Snapshot=function(t){function i(t){this.phase="construct",this.initObject(),this.parseOptions(t),this.takeSnapshot()}var r;return f(i,t),i.prototype.I="Seqin.Snapshot",i.prototype.toString=function(){return"[object "+this.I+"]"},i.prototype.phase="init",i.prototype.initObject=function(){return null==p.masters&&(p.masters=[]),null!=p.masterLut?p.masterLut:p.masterLut={}},i.prototype.parseOptions=function(t){if("undefined"==typeof t)throw new e.Error(this,"The `opt` object was not passed to "+this.I+", eg: \n`foo = new "+this.I+"({...})`");if("object"!=typeof t)throw new e.Error(this,"The `opt` argument passed to "+this.I+" has type '"+typeof t+"' not 'object'");return this.format=this.validFormat(t.format)},i.prototype.takeSnapshot=function(){var t,i,e,r,n;for(this.model={masters:[],masterLut:{}},r=p.masters,n=[],i=0,e=r.length;e>i;i++)t=r[i],n.push(this.model.masters.push(this.model.masterLut[t.id]=t.takeSnapshot()));return n},i.prototype.validFormat=function(t){if("undefined"==typeof t)throw new e.Error(this,"`format` is missing");if("string"!=typeof t)throw new e.Error(this,"`format` is type '"+typeof t+"', not 'string'");if(!r[t])throw new e.Error(this,"`format` '"+t+"' is invalid. \nPlease use "+Object.keys(r));return t},r={raw:function(t){return t},arrays:function(t){return{master:t.masters}},luts:function(t){return{master:t.masterLut}},plain:function(t){var i,e,r,n,o,s;for(r="\nSeqin.Master:",s=t.masters,i=n=0,o=s.length;o>n;i=++n)e=s[i],r+="\n  #"+i+" "+e.trackCount+"-track '"+e.id+"'";return r}},i.prototype.render=function(){return r[this.format](this.model)},i}(e.Base)}).call(this);